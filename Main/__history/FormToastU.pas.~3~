unit FormToastU;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls, Vcl.ExtCtrls;

type
  TToastFormF = class(TForm)
    tmrLife: TTimer;
    btnSnooze5: TButton;
    btnSnooze15: TButton;
    btnSnooze60: TButton;
    btnClose: TButton;
    tmrFade: TTimer;
    procedure FormCreate(Sender: TObject);
    procedure FormShow(Sender: TObject);
    procedure tmrLifeTimer(Sender: TObject);
    procedure tmrFadeTimer(Sender: TObject);
    procedure btnSnoozeClick(Sender: TObject);
    procedure btnCloseClick(Sender: TObject);
  private
    FOpacityTarget: Byte;
    procedure StartFadeOut;
  public
    procedure ShowToast(const msg: string);
  end;

var
  ToastForm: TToastFormF;

implementation

uses
  WakeHiddenU, Math;

{$R *.dfm}

procedure TToastFormF.FormCreate(Sender: TObject);
begin
  BorderStyle := bsNone;
  AlphaBlend := True;
  AlphaBlendValue := 0;
  FOpacityTarget := 255;
  Color := clInfoBk;
  Position := poDesigned;
  Width := 260;
  Height := 90;

  // Buttons positionieren
  btnSnooze5.Caption := '5 Min';
  btnSnooze15.Caption := '15 Min';
  btnSnooze60.Caption := '60 Min';
  btnClose.Caption := 'Schließen';

  btnSnooze5.SetBounds(10, 10, 55, 25);
  btnSnooze15.SetBounds(70, 10, 55, 25);
  btnSnooze60.SetBounds(130, 10, 55, 25);
  btnClose.SetBounds(190, 10, 60, 25);

  // Position: rechts unten, leicht über Taskleiste
  Left := Screen.WorkAreaWidth - Width - 10;
  Top := Screen.WorkAreaHeight - Height - 10;
end;

procedure TToastFormF.FormShow(Sender: TObject);
begin
  AlphaBlendValue := 0;
  FOpacityTarget := 255;
  tmrFade.Interval := 15;
  tmrFade.Enabled := True;

  tmrLife.Interval := 5000; // 5 Sekunden Lebensdauer
  tmrLife.Enabled := True;
end;

procedure TToastFormF.tmrFadeTimer(Sender: TObject);
begin
  if AlphaBlendValue < FOpacityTarget then
    AlphaBlendValue := Min(AlphaBlendValue + 20, FOpacityTarget)
  else if AlphaBlendValue > FOpacityTarget then
  begin
    AlphaBlendValue := Max(AlphaBlendValue - 20, FOpacityTarget);
    if AlphaBlendValue = 0 then
    begin
      tmrFade.Enabled := False;
      Hide;
    end;
  end
  else
    tmrFade.Enabled := False;
end;

procedure TToastFormF.ShowToast(const msg: string);
begin
  Caption := msg;
  Show;
end;

procedure TToastFormF.tmrLifeTimer(Sender: TObject);
begin
  tmrLife.Enabled := False;
  StartFadeOut;
end;

procedure TToastFormF.StartFadeOut;
begin
  FOpacityTarget := 0;
  tmrFade.Enabled := True;
end;

procedure TToastFormF.btnCloseClick(Sender: TObject);
begin
  StartFadeOut;
end;

procedure TToastFormF.btnSnoozeClick(Sender: TObject);
begin
  if Sender = btnSnooze5 then FormWake.DoSnooze(5)
  else if Sender = btnSnooze15 then FormWake.DoSnooze(15)
  else if Sender = btnSnooze60 then FormWake.DoSnooze(60);

  StartFadeOut;
end;

end.
